{% extends "base.html" %}

{% block extrahead %}
{{ super() }}
{% if page %}
<meta property="og:type" content="article" />
<meta property="og:title" content="{{ page.title }} - {{ config.site_name }}" />
<meta property="og:description" content="{{ page.meta.description | default(config.site_description) }}" />
<meta property="og:url" content="{{ page.canonical_url }}" />
<meta property="og:site_name" content="{{ config.site_name }}" />
<meta name="twitter:card" content="summary" />
<meta name="twitter:title" content="{{ page.title }} - {{ config.site_name }}" />
<meta name="twitter:description" content="{{ page.meta.description | default(config.site_description) }}" />
{% endif %}
{% endblock %}

{% block hero %}
<!-- Floating hamburger menu - only visible on mobile -->
<label class="mobile-menu-button" for="__drawer">
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
</label>
{% endblock %}

{% block content %}
{{ super() }}
{% if page and page.meta and page.meta.date %}
<script>
(function() {
  var date = document.createElement('div');
  date.className = 'article-date';
  date.textContent = 'Written on {{ page.meta.date }}';
  var h1 = document.querySelector('.md-content__inner h1');
  if (h1) h1.after(date);
})();
</script>

<h2>Comments</h2>
<script>
(function() {
  function getGiscusTheme() {
    var palette = document.body.getAttribute('data-md-color-scheme');
    return palette === 'slate' ? 'dark' : 'light';
  }

  // Create giscus script with current theme
  var script = document.createElement('script');
  script.src = 'https://giscus.app/client.js';
  script.setAttribute('data-repo', 'mrocklin/mrocklin.github.io');
  script.setAttribute('data-repo-id', 'MDEwOlJlcG9zaXRvcnkzNDAzMTEz');
  script.setAttribute('data-category', 'Giscus');
  script.setAttribute('data-category-id', 'DIC_kwDOADPtac4CTY1R');
  script.setAttribute('data-mapping', 'pathname');
  script.setAttribute('data-strict', '0');
  script.setAttribute('data-reactions-enabled', '1');
  script.setAttribute('data-emit-metadata', '0');
  script.setAttribute('data-input-position', 'bottom');
  script.setAttribute('data-theme', getGiscusTheme());
  script.setAttribute('data-lang', 'en');
  script.setAttribute('crossorigin', 'anonymous');
  script.async = true;
  document.currentScript.parentNode.appendChild(script);

  // Update giscus when theme changes
  var observer = new MutationObserver(function(mutations) {
    var iframe = document.querySelector('iframe.giscus-frame');
    if (iframe) {
      iframe.contentWindow.postMessage(
        { giscus: { setConfig: { theme: getGiscusTheme() } } },
        'https://giscus.app'
      );
    }
  });
  observer.observe(document.body, { attributes: true, attributeFilter: ['data-md-color-scheme'] });
})();
</script>
{% endif %}
{% endblock %}
